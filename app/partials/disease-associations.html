<div class="partial-page">
    <cttv-page-progress-spinner></cttv-page-progress-spinner>

    <div ng-show="search.total==0">
        <div class="container">
            <h3 view-title>No targets found for {{search.query}}</h3>
            Try searching a different target or disease above
        </div>
    </div>

    <div ng-if="search.total>0">

        <div class="cttv-content-header">
            <div class="container">
                <h3 view-title>{{search.total}} {{search.total===1 ? "target" : "targets"}} associated with {{search.label}}</h3>
                <p><!-- Found {{search.total}} {{search.total===1 ? "target" : "targets"}}<span class="cttv-interpage-link">--><a href="/disease/{{search.query}}"><span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-align-justify fa-stack-1x fa-inverse"></i></span> View disease profile</span></a>
                </p>
            </div>
        </div>

        <div class="container">
            <div class="row" ng-if="search.total>0">
                <div class="col-sm-3">
                    <cttv-facets></cttv-facets>

                    <!-- FILTER BY TARGETS FROM FILE -->
                    <div class="cttv-facets" ng-show="true">
                    <uib-accordion close-others=false>
                        <div uib-accordion-group  is-open="true" class="panel-default">
                            <uib-accordion-heading class="cttv-facets-headers">
                                Your target list<i
                                                   class="pull-right text-lowlight fa"
                                                   ng-class="{'fa-caret-right': filterByFileCollapsed, 'fa-caret-down': !filterByFileCollapsed}"
                                                   ng-click="filterByFileCollapsed = !filterByFileCollapsed"></i>
                            </uib-accordion-heading>

                            <div ng-if="!filterByFileCollapsed">
                                <div class="cttv-facets-controls">
                                    <!--Choose a file with list of targets-->
                                    <form ng-show ="targetArray.length == 0" name="upload" class="form" data-ng-submit="addFile()">
                                        <input id="myFileInput" type="file" name="file"
                                               onchange="angular.element(this).scope().uploadedFile(this)"/>
                                    </form>

                                    <span ng-show ="targetArray.length > 0" ng-click="removeTargets()">Clear targets from {{files[0].name}}&nbsp&nbsp<i class="fa fa-times"></i></span>
                                </div>

                                <!--Target Filter Results-->
                                <div ng-show = "targetArray.length > 0">

                                    <cttv-parent-checkbox-facet bucket="datatype" collapsed="false" partial="false"></cttv-parent-checkbox-facet>
                                    <div uib-collapse="false" style="padding-left:20px">
                                        <div cttv-checkbox-facet bucket="bucket" ng-repeat="bucket in datatype.collection.filters" partial="false"></div>
                                    </div>

                                    <!--FOUND IN FILE-->
                                    <div class="checkbox cttv-facet-checkbox clearfix">
                                        <span class="cttv-facets">
                                            <span class="cttv-facet-checkbox-label ng-binding"
                                                  ng-click="totalNamesCollapsed = !totalNamesCollapsed"
                                                  style=" cursor: pointer; cursor: hand;" title="These are all the names found in your file" data-toggle="tooltip">
                                                Target names found in file<br>
                                            </span>
                                            <span class="text-lowlight cttv-facet-count pull-left ng-binding" >({{targetNameArray.length}})</span>
                                        </span>
                                        <span  class="text-lowlight pull-right">
                                            <i class="fa fa-caret-right cttv-facets-small-arrow"
                                               ng-class="{'fa-caret-right': totalNamesCollapsed, 'fa-caret-down': !totalNamesCollapsed}"
                                               ng-click="totalNamesCollapsed = !totalNamesCollapsed"></i>
                                        </span>
                                    </div>
                                    <div >
                                        <span  class="cttv-facets" style="width:auto; padding-left: 20px"
                                           ng-if="!totalNamesCollapsed"
                                           ng-repeat="item in targetNameArray">{{item}}<br></span>
                                    </div>

                                    <!--EXCLUDED FROM SEARCH-->
                                    <div   class="checkbox cttv-facet-checkbox clearfix">
                                    <span class="cttv-facets">
                                        <span class="cttv-facet-checkbox-label ng-binding"
                                              ng-click="excludedTargetsCollapsed = !excludedTargetsCollapsed"
                                              style=" cursor: pointer; cursor: hand;"
                                              title="These are the target names from the uploaded file, for which no Ensembl ID was found - thus excluding them from the association search.">
                                            Names not found in Ensembl<br>
                                        </span>
                                        <span class="text-lowlight cttv-facet-count pull-left ng-binding" title="15">({{excludedTargetArray.length}})</span>
                                    </span>
                                    <span class="text-lowlight pull-right">
                                        <i class="fa fa-caret-right cttv-facets-small-arrow"
                                           ng-class="{'fa-caret-right': excludedTargetsCollapsed, 'fa-caret-down': !excludedTargetsCollapsed}"
                                           ng-click="excludedTargetsCollapsed = !excludedTargetsCollapsed"></i>
                                    </span>
                                    </div>
                                    <div >
                                    <span  class="cttv-facets" style="width:auto; padding-left: 20px"
                                           ng-if="!excludedTargetsCollapsed"
                                           ng-repeat="item in excludedTargetArray">{{item.name}}<br></span>
                                    </div>

                                    <!--FUZZY - NEED TO EXPLAUN - these are the ones that name did not match exactly-->
                                    <div  class="checkbox cttv-facet-checkbox clearfix">
                                    <span class="cttv-facets">
                                        <span class="cttv-facet-checkbox-label ng-binding" style="margin-left: 20px"
                                              title="These are the target names from the file for which exact match was not found but fuzzy match got similar enough name. By default they are included in association search. Clicking on the checkbox will exclude them from the search. ">
                                            <input type="checkbox" ng-click="fuzzyToggle()" ng-checked="fuzziesIncludedInSearch" style=" cursor: pointer; cursor: hand; margin-left: -20px" >
                                            Fuzzy names found<br>
                                        </span>
                                        <span class="text-lowlight cttv-facet-count pull-left ng-binding" >({{fuzzyTargetArray.length}})</span>
                                    </span>
                                    <span class="text-lowlight pull-right">
                                        <i class="fa fa-caret-right cttv-facets-small-arrow"
                                           ng-class="{'fa-caret-right': fuzzyTargetsCollapsed, 'fa-caret-down': !fuzzyTargetsCollapsed}"
                                           ng-click="fuzzyTargetsCollapsed = !fuzzyTargetsCollapsed"></i>
                                    </span>
                                    </div>
                                    <div >
                                    <span  class="cttv-facets" style="width:auto; padding-left: 20px"
                                           ng-if="!fuzzyTargetsCollapsed"
                                           ng-repeat="item in fuzzyTargetArray">For {{item.name}} found {{item.label}}<br></span>
                                    </div>

                                    <!--FUZZY - END-->
                                    <br>

                                    <div class="cttv-facets">
                                        <span class="cttv-facet-checkbox-label ng-binding">
                                            Have associations with {{search.label}}<br>
                                        </span>
                                        <span class="text-lowlight cttv-facet-count pull-left ng-binding" >
                                            ({{search.total}})
                                        </span>
                                    </div>

                                    <div class="cttv-facets">
                                        <span class="cttv-facet-checkbox-label ng-binding">
                                            No associations found for<br>
                                        </span>
                                        <span class="text-lowlight cttv-facet-count pull-left ng-binding" >
                                            ({{targetNameArray.length - search.total - excludedTargetArray.lengh }})
                                        </span>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </uib-accordion>
                    </div>

                </div>




                <div class="col-sm-9">
                    <cttv-disease-associations disease="search.query" target="targetArray"
                                               filename="search.filename"
                                               filters="filters" state-id="dat"></cttv-disease-associations>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end search results-->
